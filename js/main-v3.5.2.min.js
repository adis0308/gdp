var main={multiSelectSearch:"<input type='search' class='form-control form-control-sm' autocomplete='off' placeholder='Search'>",cookieConfig:{domain:"."+document.domain,path:"/"},init:function(){loadTooltip(),bsCustomFileInput.init(),void 0!==$.fn.DataTable&&($.fn.DataTable.ext.pager.simple_numbers_no_ellipses=function(e,t){var a=[],s=Math.floor(2),n=function(e,t){var a,s=[];void 0===t?t=0:(a=t,t=e);for(var n=t;n<a;n++)s.push(n);return s};return(a=t<=4?n(0,t):e<=s?n(0,4):e>=t-1-s?n(t-4,t):n(e-s,e+s+1)).DT_el="span",["first","previous",a,"next","last"]},$.extend(!0,$.fn.dataTable.defaults,{destroy:!0,stateSave:!0,responsive:!0,processing:!0,paging:!0,pagingType:"simple_numbers_no_ellipses",deferRender:!0,rowReorder:!0,searchDelay:2e3,language:{decimal:"",emptyTable:"No data available in table",info:"Showing _START_ to _END_ of _TOTAL_ entries",infoEmpty:"Showing 0 to 0 of 0 entries",infoFiltered:"(filtered from _MAX_ total entries)",infoPostFix:"",thousands:",",lengthMenu:"Show _MENU_ entries",loadingRecords:"Loading...",processing:"Processing...",search:"Search:",zeroRecords:"No matching records found",aria:{sortAscending:": activate to sort column ascending",sortDescending:": activate to sort column descending"},paginate:{first:'<i class="fas fa-step-backward"></i>',last:'<i class="fas fa-step-forward"></i>',next:'<i class="fas fa-chevron-right"></i>',previous:'<i class="fas fa-chevron-left"></i>'}}})),$(".carousel").carousel({interval:5e3,pause:"hover"}),$(".sweet-overlay").click((function(){$(this).hide(),$(".sweet-alert").removeClass("showSweetAlert visible").addClass("hideSweetAlert")})),void 0!==$.fn.select2&&$(".select2").select2({theme:"bootstrap4"}),$(window).on("scroll",(function(){var e=$("#gotoTop");document.body.scrollTop>640||document.documentElement.scrollTop>640?e.fadeIn():e.fadeOut()})),$("#gotoTop").on("click",(function(){$("html,body").animate({scrollTop:0},"slow")})),ajaxPOST(adminURL+"ajax/public/",{action:"get_load_balancer_list"},(function(e){localStorage.setItem("lb",JSON.stringify(e.result))}),(function(e){localStorage.setItem("lb","[]")}));var e=$("#toolbar .btn-hidden"),t='tr:first-child th:first-child input[type="checkbox"]',a='table > tbody tr td:first-child input[type="checkbox"]';$("table > thead > "+t+", table > tfoot > "+t).change((function(){var t='table > tbody tr td:first-child input[type="checkbox"]';$(this).prop("checked")?$(t).prop("checked",!0):$(t).prop("checked",!1),$(t+":checked").length>0?e.removeClass("d-none"):e.addClass("d-none")})),$(document).on("click",a,(function(){$(a+":checked").length>0?e.removeClass("d-none"):e.addClass("d-none")}));var s=Cookies.get("adm-type",main.cookieConfig),n=Cookies.get("adm-message",main.cookieConfig);void 0!==n&&showToast(n.trim(),s,(function(){Cookies.remove("adm-type",main.cookieConfig),Cookies.remove("adm-message",main.cookieConfig)}));var o=localStorage.getItem("collapseSites");o=null!==o?o.replace("true","show"):"hide",$("#collapseSites").collapse(o),$("#collapseSites").on("shown.bs.collapse",(function(){localStorage.setItem("collapseSites",!0)})).on("hidden.bs.collapse",(function(){localStorage.removeItem("collapseSites",!0)})),$("#txtSearchHost").on("blur keyup change",(function(){searchHost($(this).val().toLowerCase())})),$(".btn-shp").click((function(){var e=$(this).data("shp");void 0!==e&&("password"===$(e).attr("type")?($(e).attr("type","text"),$(this).find(".fas").removeClass("fa-eye").addClass("fa-eye-slash")):($(e).attr("type","password"),$(this).find(".fas").removeClass("fa-eye-slash").addClass("fa-eye")))})),$("#user").change((function(){$.ajax({url:adminURL+"ajax/public/",type:"POST",data:{action:"check_username",username:$(this).val()},success:function(e){ajaxValidation("#user","fail"!==e.status?"":e.message)},error:function(e){}})})),$("#email").change((function(){$.ajax({url:adminURL+"ajax/public/",type:"POST",data:{action:"check_email",email:$(this).val()},success:function(e){ajaxValidation("#email","fail"!==e.status?"":e.message)},error:function(e){}})})),$("#retype_password").change((function(){var e="#retype_password";$(this).val()!==$("#password").val()?matchValidation(e,"The confirm password must be the same as the password"):matchValidation(e,"")}))}},dashboard={videosURL:adminURL+"ajax/videos-list/",popularVideos:{list:function(){$("#tbPopularVideos").length&&$("#tbPopularVideos").DataTable({ajax:dashboard.videosURL+"?popular=true",serverSide:!0,columns:[{data:"title",responsivePriority:0,render:function(e,t,a,s){return""===e&&(e="(No Title)"),'<div class="title" contentEditable="true" data-toggle="tooltip" title="'+e+'">'+e+"</div>"}},{data:"host",className:"text-center",render:function(e,t,a,s){return a.alt_count>0?'<div class="dropdown"><button class="btn btn-outline-default btn-sm dropdown-toggle alt" type="button" data-toggle="dropdown" aria-expanded="false" data-id="'+a.id+'"><img src="'+imgCDNURL+"assets/img/logo/"+e+'.png" width="16" height="16"></button><div class="dropdown-menu shadow border-0" style="max-height:240px"></div></div>':'<a href="'+a.link+'" target="_blank" title="'+(void 0!==vidHosts[e]?vidHosts[e]:e).replace("|Additional Host","").replace("|New","")+'" data-toggle="tooltip"><img src="'+imgCDNURL+"assets/img/logo/"+e+'.png" width="16" height="16"></a>'}},{data:"views",className:"text-right"},{data:"name"},{data:"added",className:"text-right"},{data:"id",className:"text-center",render:function(e,t,a){return'<div class="btn-group">'+btnCog()+'<div class="dropdown-menu dropdown-menu-right border-0 shadow">'+btnCopyEmbed(a.actions.embed_code)+btnEmbed(a.actions.embed)+btnDownload(a.actions.download)+'<div class="dropdown-divider"></div>'+btnEditItem(adminURL+"videos/edit/?id="+e)+'<button data-id="'+e+'" onclick="videos.cache.clear.single($(this));" class="dropdown-item" type="button"><i class="fas fa-eraser mr-2"></i>Clear Cache</button></div></div>'}}],ordering:!1,lengthMenu:[7],pageLength:7,searching:!1,bLengthChange:!1,info:!1,paging:!0,columnDefs:[{orderable:!1,targets:[0,1,2,3,4,5]},{visible:!0,targets:[0,1],className:"noVis"}],drawCallback:function(e){loadTooltip(),$("#tbPopularVideos button.alt").click((function(){videos.alternatives.get($(this))})),$("#tbPopularVideos button.copy-embed").click((function(){copyText($(this).data("text"),"Embed")}))}})}},recentVideos:{list:function(){$("#tbRecentVideos").length&&$("#tbRecentVideos").DataTable({ajax:dashboard.videosURL+"?recent=true",serverSide:!0,columns:[{data:"title",responsivePriority:0,render:function(e,t,a,s){return""===e&&(e="(No Title)"),'<div class="title" contentEditable="true" data-toggle="tooltip" title="'+e+'">'+e+"</div>"}},{data:"host",className:"text-center",render:function(e,t,a,s){return a.alt_count>0?'<div class="dropdown"><button class="btn btn-outline-default btn-sm dropdown-toggle alt" type="button" data-toggle="dropdown" aria-expanded="false" data-id="'+a.id+'"><img src="'+imgCDNURL+"assets/img/logo/"+e+'.png" width="16" height="16"></button><div class="dropdown-menu shadow border-0" style="max-height:240px"></div></div>':'<a href="'+a.link+'" target="_blank" title="'+(void 0!==vidHosts[e]?vidHosts[e]:e).replace("|Additional Host","").replace("|New","")+'" data-toggle="tooltip"><img src="'+imgCDNURL+"assets/img/logo/"+e+'.png" width="16" height="16"></a>'}},{data:"views",className:"text-right"},{data:"name"},{data:"added",className:"text-right"},{data:"id",className:"text-center",render:function(e,t,a){return'<div class="btn-group">'+btnCog()+'<div class="dropdown-menu dropdown-menu-right border-0 shadow">'+btnCopyEmbed(a.actions.embed_code)+btnEmbed(a.actions.embed)+btnDownload(a.actions.download)+'<div class="dropdown-divider"></div>'+btnEditItem(adminURL+"videos/edit/?id="+e)+'<button data-id="'+e+'" onclick="videos.cache.clear.single($(this));" class="dropdown-item" type="button"><i class="fas fa-eraser mr-2"></i>Clear Cache</button></div></div>'}}],ordering:!1,lengthMenu:[7],pageLength:7,searching:!1,bLengthChange:!1,info:!1,paging:!0,columnDefs:[{orderable:!1,targets:[0,1,2,3,4,5]},{visible:!0,targets:[0,1],className:"noVis"}],drawCallback:function(e){loadTooltip(),$("#tbRecentVideos button.alt").click((function(){videos.alternatives.get($(this))})),$("#tbRecentVideos button.copy-embed").click((function(){copyText($(this).data("text"),"Embed")}))}})}},chart:{videoStatus:function(e){var t=document.querySelector(e+" > .chart"),a=$(e+" > .fa-spin"),s={chart:{id:"videoStatus",type:"donut"},legend:{position:"bottom"},series:[],labels:["Good","Broken","Warning"],colors:["#28a745","#dc3545","#feb019"]};null!==t?(a.show(),t.style.display="none",ajaxPOST(adminURL+"ajax/dashboard/",{action:"videos_status"},(function(e){a.hide(),t.style.display="block","fail"!==e.status&&(s.series[0]=e.result.good,s.series[1]=e.result.broken,s.series[2]=e.result.warning),new ApexCharts(t,s).render()}),(function(e){a.hide(),t.style.display="block",new ApexCharts(t,s).render()}))):a.hide()},serverStatus:function(e){var t=document.querySelector(e+" > .chart"),a=$(e+" > .fa-spin"),s={chart:{id:"serverStatus",type:"pie"},legend:{position:"bottom"},series:[],labels:[]};null!==t?(a.show(),t.style.display="none",ajaxPOST(adminURL+"ajax/dashboard/",{action:"servers_status"},(function(e){a.hide(),"fail"!==e.status&&(t.style.display="block",s.labels=Object.keys(e.result),s.series=Object.values(e.result),new ApexCharts(t,s).render())}),(function(e){a.hide(),t.style.display="block",new ApexCharts(t,s).render()}))):a.hide()},views:{apex:void 0,options:{series:[{name:"Visitors",data:[]}],chart:{id:"chartViews",type:"area",height:300,toolbar:{show:!1}},dataLabels:{enabled:!1},markers:{size:0,style:"hollow"},xaxis:{type:"datetime",tickAmount:6,labels:{datetimeUTC:!1}},tooltip:{x:{format:"dd MMM yyyy"}},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.7,opacityTo:.9,stops:[0,100]}}},load:function(e){var t=$("#views > .fas"),a=dashboard.chart.views.options;t.show(),ajaxPOST(adminURL+"ajax/dashboard/",{action:"views",filter:e},(function(e){t.hide(),"fail"!==e.status&&(e.result.length<30&&(a.dataLabels.enabled=!0),a.series=[{name:"Visitors",data:e.result}],dashboard.chart.views.apex.updateOptions(a))}),(function(e){t.hide()}))}}},supportChecker:function(){if(location.href.indexOf("/dashboard")>-1){var e=$("#modalExtApps");e.find(".btn-success").html('<i class="fas fa-spin fa-refresh mr-2"></i>Re-check').prop("disable",!0),ajaxPOST(adminURL+"ajax/settings/",{action:"get_dependencies"},(function(t){var a;"result"in t&&(a=Object.keys(t.result),$.each(a,(function(e,a){var s,n,o;s="#php_"+a,n=t.result[a],o="chrome"===a,n?(o=o?"Installed":"Enabled",$(s).html('<i class="fas fa-check-circle text-success mr-2"></i>'+o)):(o=o?"Uninstalled":"Disabled",$(s).html('<i class="fas fa-times-circle text-danger mr-2"></i>'+o))})),e.find(".btn-success").text("Re-check").prop("disable",!1),"fail"===t.status?e.modal("show"):e.modal("hide"))}),(function(t){e.find(".btn-success").text("Re-check").prop("disable",!1),e.modal("show")}))}}},gdrive_accounts={url:adminURL+"ajax/gdrive-accounts/",delete:{ajax:function(e,t,a){ajaxPOST(gdrive_accounts.url,{id:e,action:"delete"},t,a)},single:function(e){void 0!==e&&swal({title:"Are you sure?",text:"Delete the '"+e.data("name")+"' account. "+notRecovered(),type:"warning",showLoaderOnConfirm:!0,showCancelButton:!0,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-danger",closeOnConfirm:!1},(function(t){t&&gdrive_accounts.delete.ajax(e.data("id"),(function(e){"ok"===e.status?(gdrive_accounts.reload(),swalSuccess(e.message)):swalError(e.message)}),(function(e){swalError(e.responseText)}))}))},multi:function(){var e=[],t=[],a=[];if($("#ckAllGDA, #ckAllGDA1").prop("checked",!1),$("#tbGDAccounts tbody input[type=checkbox]:checked").each((function(){e.push($(this).val())})),e.length>0){var s=function(s,o){var i,l=o+1;"fail"!==s.status?t.push(e[o]):a.push(e[o]),(i=t.length+a.length)>=e.length?(gdrive_accounts.reload(),a.length>0?swalInfo("The "+t.length+" accounts have been successfully deleted and the other "+a.length+" accounts failed to be deleted."):swalSuccess("These "+i+" accounts have been successfully deleted.")):n(e[l],l)},n=function(e,t){gdrive_accounts.delete.ajax(e,(function(e){s(e,t)}),(function(e){s({status:"fail"},t)}))};swal({title:"Are you sure?",text:"You will delete these "+e.length+" accounts. "+notRecovered(),type:"warning",showLoaderOnConfirm:!0,showCancelButton:!0,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-danger",closeOnConfirm:!1},(function(t){t&&n(e[0],0)}))}else swalWarning("Please check the accounts you want to delete first.")}},update_status:{ajax:function(e,t,a){ajaxPOST(gdrive_accounts.url,e,t,a)},single:function(e){void 0!==e&&gdrive_accounts.update_status.ajax({id:e.data("id"),status:e.data("status"),action:"update_status"},(function(e){"fail"!==e.status?(gdrive_accounts.reload(),swalSuccess(e.message)):swalError(e.message)}),(function(e){swalError(e.responseText)}))}},list:function(){$("#tbGDAccounts").length&&$("#tbGDAccounts").DataTable({ajax:adminURL+"ajax/gdrive-accounts-list/",serverSide:!0,columns:[{data:"id",className:"text-center",render:function(e,t,a,s){return btnCheckbox(e,"gda")}},{data:"email",responsivePriority:0},{data:"status",responsivePriority:1,className:"text-center",render:function(e,t,a,s){var n="fa-times-circle text-danger",o="Disable",i=1;return"1"===e&&(n="fa-check-circle text-success",o="Enable",1,i=0),'<a href="javascript:void(0)" role="button" data-id="'+a.id+'" data-status="'+i+'" class="status" data-toggle="tooltip" title="'+o+'"><i class="fas fa-lg '+n+'"></i></a>'}},{data:"created",className:"text-center"},{data:"modified",className:"text-center"},{data:"id",className:"text-center",responsivePriority:2,render:function(e,t,a){return'<div class="dropdown">'+btnCog()+'<div class="dropdown-menu dropdown-menu-right border-0 shadow">'+btnEditItem(adminURL+"gdrive/edit/?id="+e)+btnDeleteItem(e,a.email)+"</div></div>"}}],columnDefs:[{orderable:!1,targets:[0,5]},{visible:!0,targets:[0,1,5],className:"noVis"}],order:[[1,"asc"]],drawCallback:function(e){loadTooltip(),$("#tbGDAccounts a.status").click((function(){gdrive_accounts.update_status.single($(this))})),$("#tbGDAccounts button.delete").click((function(){gdrive_accounts.delete.single($(this))}))}})},reload:function(){$("#ckAllGDA, #ckAllGDA1").prop("checked",!1),$("#toolbar .btn-hidden").addClass("d-none"),$("#tbGDAccounts").DataTable().ajax.reload(null,!1)}},gdrive_files={url:adminURL+"ajax/gdrive-files/",update_status:{ajax:function(e,t,a){ajaxPOST(gdrive_files.url,e,t,a)},single:function(e){void 0!==e&&gdrive_files.update_status.ajax({id:e.data("id"),email:$_GET("email"),action:e.data("status")},(function(e){"fail"!==e.status?(gdrive_files.reload(),swalSuccess(e.message)):swalError(e.message)}),(function(e){swalError(e.responseText)}))},multi:function(e){var t=[],a=[],s=[];if($("#ckAllGDF, #ckAllGDF1").prop("checked",!1),$("#tbGDFiles tbody input[type=checkbox]:checked").each((function(){t.push($(this).val())})),t.length>0){var n=function(e,n){var i,l=n+1;"fail"!==e.status?a.push(t[n]):s.push(t[n]),(i=a.length+s.length)>=t.length?(gdrive_files.reload(),s.length>0?swalInfo(a.length+" files have been updated successfully and "+s.length+" other files failed to update."):swalSuccess("These "+i+" files have been successfully updated.")):o(t[l],l)},o=function(t,a){gdrive_files.update_status.ajax({id:t,email:$_GET("email"),action:e},(function(e){n(e,a)}),(function(e){n({status:"fail"},a)}))};swal({title:"Are you sure?",text:"You will change the status of those "+t.length+" files to "+e+".",type:"warning",showLoaderOnConfirm:!0,showCancelButton:!0,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-primary",closeOnConfirm:!1},(function(e){e&&o(t[0],0)}))}else swalWarning("Please check the files that you want to change the status of first.")}},reload:function(){$("#ckAllGDF, #ckAllGDF1").prop("checked",!1),$("#toolbar .btn-hidden").addClass("d-none"),$("#tbGDFiles").DataTable().ajax.reload(null,!1)},list:function(){if($("#tbGDFiles").length){var e=$("select#email").val(),t=md5(e);$("#tbGDFiles").on("preXhr.dt",(function(a,s,n){var o=s._iDisplayStart-s._iDisplayLength;n.private=$("#onlyPrivate").is(":checked"),n.onlyFolder=$("#onlyFolder").is(":checked"),null!==e&&(n.email=e,n.folder_id=$_GET("folder_id")),o>=0&&(n.token=localStorage.getItem("nextPageToken-"+t+"-"+o))})).DataTable({ajax:adminURL+"ajax/gdrive-files-list/",serverSide:!0,info:!1,pagingType:"simple",columns:[{data:"id",responsivePriority:0,className:"text-center",render:function(e,t,a,s){return btnCheckbox(e,"gdf")}},{data:"title",responsivePriority:1,render:function(e,t,a,s){return"type"in a.mimeType&&-1===a.mimeType.type.indexOf(".folder")?'<div class="title" contentEditable="true" data-toggle="tooltip" title="'+e+'"><img src="'+a.mimeType.icon+'" class="mr-2">'+e+"</div>":""!==a.id?'<a href="'+adminURL+"gdrive/files/?email="+a.email+"&folder_id="+a.id+'" class="title" data-toggle="tooltip" title="'+e+'"><img src="'+a.mimeType.icon+'" class="mr-2">'+e+"</a>":'<a href="'+adminURL+"gdrive/files/?email="+a.email+'" class="title" data-toggle="tooltip" title="Back">'+e+"</a>"}},{data:"desc",responsivePriority:2,render:function(e,t,a,s){return'<div class="title" contentEditable="true" data-toggle="tooltip" title="'+e+'">'+e+"</div>"}},{data:"shared",className:"text-center",render:function(e,t,a,s){return'<i class="fas fa-lg fa-'+(e?"check-circle text-success":"times-circle text-danger")+'"></i>'}},{data:"modifiedDate",className:"text-right"},{data:"actions",className:"text-center",responsivePriority:3,render:function(e,t,a,s){if(""!==a.id){var n='<button type="button" class="dropdown-item rename" data-id="'+e.id+'" data-name="'+a.title+'"><i class="fas fa-pen-to-square mr-2"></i>Rename</button>';return e.shared?n+='<button type="button" class="dropdown-item private" data-id="'+e.id+'" data-status="private" title="Make it Private"><i class="fas fa-eye-slash mr-2"></i>Private</button>':n+='<button type="button" class="dropdown-item public" data-id="'+e.id+'" data-status="public" title="Share with the Public"><i class="fas fa-eye mr-2"></i>Public</button>',n+='<button type="button" class="dropdown-item delete" data-id="'+e.id+'" data-name="'+a.title+(""!==a.desc?" - "+a.desc:"")+'"><i class="fas fa-trash mr-2"></i>Delete</button>',"type"in a.mimeType&&-1===a.mimeType.type.indexOf(".folder")&&(n+='<div class="dropdown-divider"></div><a class="dropdown-item" href="'+e.view+'" target="_blank"><i class="fas fa-binoculars mr-2"></i>View</a><a class="dropdown-item" href="'+e.download+'" target="_blank"><i class="fas fa-download mr-2"></i>Download</a><a class="dropdown-item" href="'+e.preview+'" target="_blank"><i class="fas fa-magnifying-glass mr-2"></i>Preview</a><div class="dropdown-divider"></div>'+btnEmbed(e.embed_link)+btnDownload(e.download_link)+btnCopyEmbed(e.embed_code)),'<div class="btn-group">'+btnCog()+'<div class="dropdown-menu dropdown-menu-right border-0 shadow">'+n+"</div></div>"}return""}}],columnDefs:[{orderable:!1,targets:[0,2,3,5]},{visible:!0,targets:[0,1,2],className:"noVis"}],order:[[4,"desc"]],drawCallback:function(a){null!==e&&void 0!==a.json.token&&null!==a.json.token&&""!==a.json.token&&localStorage.setItem("nextPageToken-"+t+"-"+a._iDisplayStart,a.json.token),$("#tbGDFiles button.public, #tbGDFiles button.private").click((function(){gdrive_files.update_status.single($(this))})),$("#tbGDFiles button.delete").click((function(){gdrive_files.delete.single($(this))})),$("#tbGDFiles button.rename").click((function(){gdrive_files.rename($(this))})),$("#tbGDFiles button.copy-embed").click((function(){copyText($(this).data("text"),"Embed")})),gdrive_files.loadDrives(),loadTooltip()}})}},delete:{ajax:function(e,t,a){ajaxPOST(gdrive_files.url,{id:e,email:$_GET("email"),action:"delete"},t,a)},single:function(e){void 0!==e&&swal({title:"Are you sure?",text:"Delete the '"+e.data("name")+"' file.",type:"warning",showLoaderOnConfirm:!0,showCancelButton:!0,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-danger",closeOnConfirm:!1},(function(t){t&&gdrive_files.delete.ajax(e.data("id"),(function(e){"fail"!==e.status?(gdrive_files.reload(),swalSuccess(e.message)):swalError(e.message)}),(function(e){swalError(e.responseText)}))}))},multi:function(){var e=[],t=[],a=[];if($("#ckAllGDF, #ckAllGDF1").prop("checked",!1),$("#tbGDFiles tbody input[type=checkbox]:checked").each((function(){e.push($(this).val())})),e.length>0){var s=function(s,o){var i,l=o+1;"fail"!==s.status?t.push(e[o]):a.push(e[o]),(i=t.length+a.length)>=e.length?(gdrive_files.reload(),a.length>0?swalInfo("The "+t.length+" files have been successfully deleted and the other "+a.length+" files failed to be deleted."):swalSuccess("The "+i+" files have been successfully deleted.")):n(e[l],l)},n=function(e,t){gdrive_files.delete.ajax(e,(function(e){s(e,t)}),(function(e){s({status:"fail"},t)}))};swal({title:"Are you sure?",text:"You will delete these "+e.length+" files.",type:"warning",showLoaderOnConfirm:!0,showCancelButton:!0,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-primary",closeOnConfirm:!1},(function(t){t&&n(e[0],0)}))}else swalWarning("Please check the files you want to delete first.")}},newFolder:function(){swal({title:"Create New Folder",type:"input",showLoaderOnConfirm:!0,showCancelButton:!0,closeOnConfirm:!1,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-success",inputPlaceholder:"Folder Name",confirmButtonText:"Save"},(function(e){if(!1===e)return!1;if(""===e.trim())return swal.showInputError("You need to write something!"),!1;var t=$_GET("folder_id");t=null!==t?t:"root",$.ajax({url:gdrive_files.url,method:"POST",dataType:"json",data:"action=new_folder&name="+e+"&parent_id="+t+"&email="+$("select#email").val(),success:function(e){"fail"!==e.status?(gdrive_files.reload(),swalSuccess(e.message)):swalError(e.message)},error:function(e){swalError(e.responseText)}})}))},changeEmail:function(e){var t,a=location.href.split("?"),s="";for(t in localStorage)(s=localStorage.key(t)).indexOf("gdrive/files")>-1&&localStorage.removeItem(s);location.href=a[0]+"?email="+e.val()},import:{ajax:function(e,t,a){ajaxPOST(gdrive_files.url,{id:e,action:"gdrive_import"},t,a)},single:function(e){gdrive_files.import.ajax(e.data("id"),(function(e){"fail"!==e.status?swalSuccess(e.message):swalError(e.message)}),(function(e){swalError(e.responseText)}))},multi:function(){var e=[],t=[],a=[];if($("#ckAllGDF, #ckAllGDF1").prop("checked",!1),$("#tbGDFiles tbody input[type=checkbox]:checked").each((function(){e.push($(this).val())})),e.length>0){var s=function(s,o){var i,l=o+1;"fail"!==s.status?t.push(e[o]):a.push(e[o]),(i=t.length+a.length)>=e.length?(a.length>0?swalInfo("The "+t.length+" files have been successfully imported and the other "+a.length+" files failed to be imported."):swalSuccess("The "+i+" files have been successfully imported."),gdrive_files.reload()):n(e[l],l)},n=function(e,t){gdrive_files.import.ajax(e,(function(e){s(e,t)}),(function(e){s({status:"fail"},t)}))};n(e[0],0)}else swalWarning("Please check the files you want to import first.")}},loadDrives:function(){var e=$("#drives").find("optgroup");ajaxPOST(gdrive_files.url,{email:$_GET("email"),action:"shared-drives"},(function(t){if(t.result.length)for(var a in e.html(""),t.result)e.append('<option value="'+t.result[a].id+'" '+($_GET("folder_id")===t.result[a].id?"selected":"")+">"+t.result[a].name+"</option>")}),(function(e){console.log(e)}))},rename:function(e){swal({title:"Rename File/Folder",type:"input",inputValue:e.data("name"),showLoaderOnConfirm:!0,showCancelButton:!0,closeOnConfirm:!1,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-success",inputPlaceholder:"File/Folder Name",confirmButtonText:"Update"},(function(t){return!1!==t&&(""===t.trim()?(swal.showInputError("You need to write something!"),!1):void $.ajax({url:gdrive_files.url,method:"POST",dataType:"json",data:"action=renameFileFolder&name="+t+"&id="+e.data("id")+"&email="+$("select#email").val(),success:function(e){"fail"!==e.status?(gdrive_files.reload(),swalSuccess(e.message)):swalError(e.message)},error:function(e){swalError(e.responseText)}}))}))}},gdrive_backup_files={url:adminURL+"ajax/gdrive-backup-files/",reload:function(){$("#ckAllGDBF, #ckAllGDBF1").prop("checked",!1),$("#toolbar .btn-hidden").addClass("d-none"),$("#tbGDBackupFiles").DataTable().ajax.reload(null,!1)},list:function(){$("#tbGDBackupFiles").length&&$("#tbGDBackupFiles").DataTable({ajax:adminURL+"ajax/gdrive-backup-files-list/",serverSide:!0,columns:[{data:"id",responsivePriority:0,className:"text-center",render:function(e){return btnCheckbox(e,"gdbf")}},{data:"gdrive_id",responsivePriority:1,render:function(e){return gdriveViewLink(e)}},{data:"mirror_id",responsivePriority:2,render:function(e){return gdriveViewLink(e)}},{data:"mirror_email"},{data:"added",className:"text-right"},{data:"id",className:"text-center",responsivePriority:3,render:function(e,t,a){return'<button data-id="'+e+'" data-name="'+a.mirror_id+'" data-toggle="tooltip" title="Delete" type="button" class="btn btn-danger btn-sm delete"><i class="fas fa-trash-alt"></i></button>'}}],columnDefs:[{orderable:!1,targets:[0,5]},{visible:!0,targets:[0,3,4],className:"noVis"}],order:[[4,"desc"]],drawCallback:function(e){loadTooltip(),$("#tbGDBackupFiles button.delete").click((function(){gdrive_backup_files.delete.single($(this))}))}})},delete:{ajax:function(e,t,a){ajaxPOST(gdrive_backup_files.url,{id:e,action:"delete"},t,a)},single:function(e){void 0!==e&&swal({title:"Are you sure?",text:"Delete backup file '"+e.data("name")+"'. "+notRecovered(),type:"warning",showLoaderOnConfirm:!0,showCancelButton:!0,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-danger",closeOnConfirm:!1},(function(t){t&&gdrive_backup_files.delete.ajax(e.data("id"),(function(e){"fail"!==e.status?(gdrive_backup_files.reload(),swalSuccess(e.message)):swalError(e.message)}),(function(e){swalError(e.responseText)}))}))},multi:function(){var e=[],t=[],a=[];if($("#ckAllGDBF, #ckAllGDBF1").prop("checked",!1),$("#tbGDBackupFiles tbody input[type=checkbox]:checked").each((function(){e.push($(this).val())})),e.length>0){var s=function(s,o){var i,l=o+1;"fail"!==s.status?t.push(e[o]):a.push(e[o]),(i=t.length+a.length)>=e.length?(gdrive_backup_files.reload(),a.length>0?swalInfo(t.length+" backup files were successfully deleted and "+a.length+" other backup files failed to be deleted."):swalSuccess("These "+i+" backup files have been successfully deleted.")):n(e[l],l)},n=function(e,t){gdrive_backup_files.delete.ajax(e,(function(e){s(e,t)}),(function(e){s({status:"fail"},t)}))};swal({title:"Are you sure?",text:"You will delete "+e.length+" backup files. "+notRecovered(),type:"warning",showLoaderOnConfirm:!0,showCancelButton:!0,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-danger",closeOnConfirm:!1},(function(t){t&&n(e[0],0)}))}else swalWarning("Please check the backup files you want to delete first.")}}},gdrive_backup_queue={url:adminURL+"ajax/gdrive-backup-queue/",reload:function(){$("#ckAllGDQF, #ckAllGDQF1").prop("checked",!1),$("#toolbar .btn-hidden").addClass("d-none"),$("#tbGDBackupQueue").DataTable().ajax.reload(null,!1)},list:function(){$("#tbGDBackupQueue").length&&$("#tbGDBackupQueue").DataTable({ajax:adminURL+"ajax/gdrive-backup-queue-list/",serverSide:!0,columns:[{data:"id",className:"text-center",responsivePriority:2,render:function(e){return btnCheckbox(e,"gdbf")}},{data:"gdrive_id",responsivePriority:0,render:function(e){return gdriveViewLink(e)}},{data:"id",className:"text-center",responsivePriority:1,render:function(e,t,a){return'<button data-id="'+a.gdrive_id+'" data-toggle="tooltip" title="Copy File" type="button" class="btn btn-primary btn-sm copy-file"><i class="fas fa-copy"></i></button>&nbsp;<button data-id="'+e+'" data-name="'+a.gdrive_id+'" data-toggle="tooltip" title="Delete" type="button" class="btn btn-danger btn-sm delete"><i class="fas fa-trash-alt"></i></button>'}}],columnDefs:[{orderable:!1,targets:[0,2]},{visible:!0,targets:[0,1],className:"noVis"}],drawCallback:function(e){loadTooltip(),$("#tbGDBackupQueue button.delete").click((function(){gdrive_backup_queue.delete.single($(this))})),$("#tbGDBackupQueue button.copy-file").click((function(){$(this).prop("disabled",!0),gdrive_backup_queue.copy($(this))}))}})},copy:function(e){ajaxPOST(gdrive_backup_queue.url,{id:e.data("id"),action:"copy"},(function(t){e.prop("disabled",!1),"fail"!==t.status?(gdrive_backup_queue.reload(),swalSuccess(t.message)):swalError(t.message)}),(function(t){e.prop("disabled",!1),swalError(t.responseText)}))},delete:{ajax:function(e,t,a){ajaxPOST(gdrive_backup_queue.url,{id:e,action:"delete"},t,a)},single:function(e){void 0!==e&&swal({title:"Are you sure?",text:"Delete backup queue '"+e.data("name")+"'. "+notRecovered(),type:"warning",showLoaderOnConfirm:!0,showCancelButton:!0,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-danger",closeOnConfirm:!1},(function(t){t&&gdrive_backup_queue.delete.ajax(e.data("id"),(function(e){"fail"!==e.status?(gdrive_backup_queue.reload(),swalSuccess(e.message)):swalError(e.message)}),(function(e){swalError(e.responseText)}))}))},multi:function(){var e=[],t=[],a=[];if($("#ckAllGDQF, #ckAllGDQF1").prop("checked",!1),$("#tbGDBackupQueue tbody input[type=checkbox]:checked").each((function(){e.push($(this).val())})),e.length>0){var s=function(s,o){var i,l=o+1;"fail"!==s.status?t.push(e[o]):a.push(e[o]),(i=t.length+a.length)>=e.length?(gdrive_backup_queue.reload(),a.length>0?swalInfo(t.length+" backup queue were successfully deleted and "+a.length+" other backup queue failed to be deleted."):swalSuccess("These "+i+" backup queue have been successfully deleted.")):n(e[l],l)},n=function(e,t){gdrive_backup_queue.delete.ajax(e,(function(e){s(e,t)}),(function(e){s({status:"fail"},t)}))};swal({title:"Are you sure?",text:"You will delete "+e.length+" backup queue. "+notRecovered(),type:"warning",showLoaderOnConfirm:!0,showCancelButton:!0,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-danger",closeOnConfirm:!1},(function(t){t&&n(e[0],0)}))}else swalWarning("Please check the backup files you want to delete first.")}}},load_balancers={url:adminURL+"ajax/load-balancers/",reload:function(){$("#tbLoadBalancers").DataTable().ajax.reload(null,!1)},delete:function(e){void 0!==e&&swal({title:"Are you sure?",text:"Delete the '"+e.data("name")+"' server. "+notRecovered(),type:"warning",showLoaderOnConfirm:!0,showCancelButton:!0,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-danger",closeOnConfirm:!1},(function(t){t&&ajaxPOST(load_balancers.url,{id:e.data("id"),action:"delete"},(function(e){"fail"!==e.status?(load_balancers.reload(),swalSuccess(e.message)):swalError(e.message)}),(function(e){swalError(e.responseText)}))}))},update_status:function(e){void 0!==e&&ajaxPOST(load_balancers.url,{id:e.data("id"),status:e.data("status"),action:"update_status"},(function(e){"fail"!==e.status?(load_balancers.reload(),swalSuccess(e.message)):swalError(e.message)}),(function(e){swalError(e.responseText)}))},list:function(){$("#tbLoadBalancers").length&&$("#tbLoadBalancers").DataTable({ajax:adminURL+"ajax/load-balancers-list/",serverSide:!0,columns:[{data:"name",responsivePriority:0},{data:"link",responsivePriority:1,render:function(e,t,a,s){return'<a href="'+e+'" target="_blank">'+e+"</a>"}},{data:"playbacks",className:"text-right"},{data:"status",className:"text-center",render:function(e,t,a,s){var n="Disable",o="fa-check-circle text-success",i=0;return 0===Number(e)&&(n="Enable",o="fa-times-circle text-danger",i=1),'<a href="javascript:void(0)" class="status" data-id="'+a.id+'" data-status="'+i+'" data-toggle="tooltip" title="'+n+'"><i class="fas fa-lg '+o+'"></i></a>'}},{data:"added",className:"text-right"},{data:"updated",className:"text-right"},{data:"id",className:"text-center",responsivePriority:2,render:function(e,t,a){return'<div class="btn-group">'+btnCog()+'<div class="dropdown-menu dropdown-menu-right border-0 shadow">'+btnEditItem(adminURL+"settings/load-balancers/edit/?id="+e)+btnDeleteItem(e,a.name)+'<button type="button" class="dropdown-item clear" data-id="'+e+'" data-url="'+a.link+'admin-api/"><i class="fas fa-refresh mr-2"></i>Clear Cache</button></div></div>'}}],columnDefs:[{orderable:!1,targets:[2,6]},{visible:!0,targets:[1,2,3],className:"noVis"}],order:[[4,"desc"]],drawCallback:function(e){loadTooltip(),$("a.status").click((function(){load_balancers.update_status($(this))})),$("#tbLoadBalancers button.clear").click((function(){load_balancers.clear($(this))})),$("#tbLoadBalancers button.delete").click((function(){load_balancers.delete($(this))}))}})},clear:function(e){void 0!==e&&ajaxPOST(e.data("url"),{id:e.data("id"),action:"clear_load_balancer",token:Cookies.get("adv_token",main.cookieConfig)},(function(e){"fail"!==e.status?swalSuccess(e.message):swalError(e.message)}),(function(e){swalError(e.responseText)}))},resetHost:function(){$("#resetLBHost").prop("disabled",!0),ajaxPOST(settings.url,{action:"reset_hosts"},(function(e){$("#resetLBHost").prop("disabled",!1),"fail"!==e.status?($("#bypass_hosts").find("option").removeAttr("selected"),$("#bypass_hosts").multiSelect("select",e.result),$("#bypass_hosts").multiSelect("refresh"),swalSuccess(e.message)):swalError(e.message)}),(function(e){swalError(e.responseText)}))}},settings={url:adminURL+"ajax/settings/",disableBlacklistedVideos:function(e){swal({title:"Are you sure?",text:"You will disable videos with titles containing blacklisted words.",type:"warning",showLoaderOnConfirm:!0,showCancelButton:!0,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-danger",closeOnConfirm:!1},(function(t){t&&(e.prop("disabled",!0),ajaxPOST(settings.url,{action:"disable_blacklisted_videos"},(function(t){"fail"!==t.status?($("#word_blacklisted").val(t.result),swalSuccess(t.message)):swalSuccess(t.message),e.prop("disabled",!1)}),(function(t){swalError(res.responseText),e.prop("disabled",!1)})))}))},smtp:function(){var e=$("#smtp_provider").val(),t=$("#smtp_host"),a=$("#smtp_port"),s=$("#smtp_tls"),n={};"other"!==e?(n={gmail:{host:"smtp.gmail.com",port:465,tls:!1},ymail:{host:"smtp.mail.yahoo.com",port:587,tls:!0},outlook:{host:"smtp.office365.com",port:587,tls:!0}}[e],t.val(n.host),a.val(n.port),s.prop("checked",!0)):(t.val(""),a.val(""),s.prop("checked",!1))},vast:{remove:function(e){$("#vastWrapper .form-group[data-index="+e+"]").remove()},add:function(){var e=$("#vastWrapper"),t=e.find(".form-group").length;e.append('<div class="form-group" data-index="'+t+'"><div class="input-group"><div class="input-group-prepend" style="max-width:110px"><input type="text" placeholder="Ad Position" name="opt[vast_offset][]" id="vast_offset-'+t+'" class="form-control"></div><input type="url" name="opt[vast_xml][]" id="vast_xml-'+t+'" placeholder="VAST URL (.xml)" class="form-control"><div class="input-group-append"><button type="button" class="btn btn-danger" onclick="settings.vast.remove('+t+')" data-toggle="tooltip" title="Remove VAST"><i class="fas fa-minus"></i></button></div></div></div>'),loadTooltip()},delete:function(e){void 0!==e?ajaxPOST(settings.url,{action:"delete_custom_vast",file_name:e.data("id")},(function(t){"fail"!==t.status?swalSuccess(t.message):swalError(t.message),e.closest("li").remove()}),(function(e){swalError(e.responseText)})):swalWarning("Please select the VAST you want to delete!")}},changeCache:function(e){var t=e.find('option[value="files"]');ajaxPOST(settings.url,{action:"extension_checker",extension:e.val()},(function(e){"fail"===e.status&&(t.prop("selected",!0),swalError(e.message))}),(function(e){swalError(e.responseText),t.prop("selected",!0)}))},checkProxy:function(){var e=$("#checkProxy"),t=e.html(),a=["proxy_docker_com","free_proxy_cz","free_proxy_list_net"],s=[],n=[],o=function(){s.length+n.length>=a.length&&(e.html(t).prop("disabled",!1),swalSuccess("The proxy list has been successfully updated."))};e.html(t+'<i class="fas fa-spin fa-sync-alt ml-2"></i>').prop("disabled",!0),""!==$("#proxy_list").val()?ajaxGET(baseURL+"cron-proxy/",(function(a){"fail"!==a.status?swalSuccess(a.message):swalError(a.message),e.html(t).prop("disabled",!1)}),(function(a){swalError(a.responseText),e.html(t).prop("disabled",!1)})):$.each(a,(function(e,t){!function(e){ajaxGET(baseURL+"cron-proxy/?host="+e,(function(t){"fail"!==t.status?(s.push(e),$("#proxy_list").val(t.result)):n.push(e),o()}),(function(t){n.push(e),o()}))}(t)}))},clearCache:{cleared:0,failed:0,total:0,callback:function(e){var t=settings.clearCache;void 0===e.responseJSON?t.failed+=1:"fail"!==e.status?t.cleared+=1:t.failed+=1,t.cleared+t.failed>=t.total&&(t.cleared>=t.total?swalSuccess("The cache has been successfully cleared."):swalError("The cache failed to clear or the cache does not exist."),$("#clearCache").prop("disabled",!1))},all:function(){var e=localStorage.getItem("lb"),t="null"!==e?JSON.parse(e):[baseURL],a=settings.clearCache.callback;t.length>0&&swal({title:"Are you sure!",text:"You will clear all cache.",type:"warning",showLoaderOnConfirm:!0,showCancelButton:!0,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-danger",closeOnConfirm:!1},(function(e){e&&($("#clearCache").prop("disabled",!0),$.each(t,(function(e,t){ajaxPOST(t+"admin-api/",{action:"clear_cache",token:Cookies.get("adv_token",main.cookieConfig)},a,a)})))}))},videos:function(){var e=localStorage.getItem("lb"),t=e?JSON.parse(e):[],a=settings.clearCache.callback;t.length>0&&swal({title:"Are you sure!",text:"You will clear all video cache.",type:"warning",showLoaderOnConfirm:!0,showCancelButton:!0,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-danger",closeOnConfirm:!1},(function(e){e&&($("#clearCache").prop("disabled",!0),$.each(t,(function(e,t){ajaxPOST(t+"admin-api/",{action:"clear_all_video_cache",token:Cookies.get("adv_token",main.cookieConfig)},a,a)})))}))},hlsmpd:function(){var e=localStorage.getItem("lb"),t=e?JSON.parse(e):[],a=settings.clearCache.callback;t.length>0&&swal({title:"Are you sure!",text:"You will clear the cache of HLS and MPD video files.",type:"warning",showLoaderOnConfirm:!0,showCancelButton:!0,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-danger",closeOnConfirm:!1},(function(e){e&&($("#clearCache").prop("disabled",!0),$.each(t,(function(e,t){ajaxPOST(t+"admin-api/",{action:"clear_hlsmpd_video_cache",token:Cookies.get("adv_token",main.cookieConfig)},a,a)})))}))},settings:function(){var e=localStorage.getItem("lb"),t=e?JSON.parse(e):[],a=settings.clearCache.callback;t.length>0&&swal({title:"Are you sure!",text:"You will clear all settings cache.",type:"warning",showLoaderOnConfirm:!0,showCancelButton:!0,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-danger",closeOnConfirm:!1},(function(e){e&&($("#clearCache").prop("disabled",!0),$.each(t,(function(e,t){ajaxPOST(t+"admin-api/",{action:"clear_settings_cache",token:Cookies.get("adv_token",main.cookieConfig)},a,a)})))}))}},resetHost:function(){var e=$("#resetHost").html();swal({title:"Are you sure?",text:"Return the hosts to their original position. Then clear the settings cache.",type:"warning",showLoaderOnConfirm:!0,showCancelButton:!0,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-warning",closeOnConfirm:!1},(function(t){t&&($("#resetHost").html(e+'<i class="fas fa-spin fa-sync-alt ml-2"></i>').prop("disabled",!0),ajaxPOST(settings.url,{action:"reset_hosts"},(function(t){$("#resetHost").html(e).prop("disabled",!1),"fail"!==t.status?($("#bypass_host").find("option").removeAttr("selected"),$("#bypass_host").multiSelect("select",t.result),$("#bypass_host").multiSelect("refresh"),swalSuccess(t.message)):swalError(t.message)}),(function(e){swalError(e.responseText)})))}))}},subtitles={url:adminURL+"ajax/subtitles/",loadHosts:function(){ajaxPOST(subtitles.url,{action:"get_hosts"},(function(e){if("fail"!==e.status){var t="",a=$("#oldLocation"),s=0;for(s in a.html(""),e.result)t+='<option value="'+e.result[s]+'">'+e.result[s]+"</option>";a.html(t)}}),(function(e){swalError(e.responseText)}))},html:function(e){var t='<select name="'+e+'" class="form-control select2">';return $.each(languages,(function(e,a){t+='<option value="'+a+'">'+a+"</option>"})),t+"</select>"},migrate:function(){subtitles.loadHosts(),$("#modalHostSub").modal("show"),$("#frmMigrateSub").on("submit",(function(e){if(e.preventDefault(),e.stopPropagation(),!1!==this.checkValidity()){var t=$(this).find('button[type="submit"]');$.ajax({type:"POST",url:subtitles.url,cache:!1,data:$(this).serialize(),beforeSend:function(){t.prop("disabled",!0)},complete:function(){t.prop("disabled",!1)},success:function(e){"fail"!==e.status?(subtitles.reload(),showToast(e.message,"success"),$("#frmMigrateSub")[0].reset()):showToast(e.message,"error")},error:function(){showToast("Server cannot be accessed. Please contact admins!","error")}})}else $(this).addClass("was-validated")}))},rename:function(e){void 0!==e&&swal({title:"Rename",type:"input",inputValue:e.data("name"),showLoaderOnConfirm:!0,showCancelButton:!0,closeOnConfirm:!1,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-success",inputPlaceholder:"File Name",confirmButtonText:"Save"},(function(t){return!1!==t&&(""===t.trim()?(swal.showInputError("You need to write something!"),!1):void ajaxPOST(subtitles.url,{action:"rename",name:t,id:e.data("id")},(function(e){"fail"!==e.status?(subtitles.reload(),swalSuccess(e.message)):swalError(e.message)}),(function(e){swalError(e.responseText)})))}))},delete:{ajax:function(e,t,a){ajaxPOST(subtitles.url,{action:"delete",id:e},t,a)},single:function(e){void 0!==e?swal({title:"Are you sure?",text:"Delete the '"+e.data("name")+"' subtitle file. "+notRecovered(),type:"warning",showLoaderOnConfirm:!0,showCancelButton:!0,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-danger",closeOnConfirm:!1},(function(t){t&&subtitles.delete.ajax(e.data("id"),(function(e){"fail"!==e.status?(subtitles.reload(),swalSuccess(e.message)):swalError(e.message)}),(function(e){swalError(e.responseText)}))})):swalWarning("Please select the subtitle you want to delete!")},multi:function(){var e=[],t=[],a=[];if($("#ckAllSubtitles, #ckAllSubtitles1").prop("checked",!1),$("#tbSubtitles tbody input[type=checkbox]:checked").each((function(){e.push($(this).val())})),e.length>0){var s=function(s,o){var i,l=o+1;"fail"!==s.status?t.push(e[o]):a.push(e[o]),(i=t.length+a.length)>=e.length?(subtitles.reload(),a.length>0?swalInfo("The "+t.length+" subtitle files have been successfully deleted and the other "+a.length+" subtitle files failed to be deleted."):swalSuccess("The "+i+" subtitle files have been successfully deleted.")):n(e[l],l)},n=function(e,t){subtitles.delete.ajax(e,(function(e){s(e,t)}),(function(e){s({status:"fail"},t)}))};swal({title:"Are you sure?",text:"You will delete "+e.length+" subtitle files. "+notRecovered(),type:"warning",showLoaderOnConfirm:!0,showCancelButton:!0,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-danger",closeOnConfirm:!1},(function(t){t&&n(e[0],0)}))}else swalWarning("Please check the subtitle files you want to delete first.")}},list:function(){$("#tbSubtitles").length&&$("#tbSubtitles").DataTable({ajax:adminURL+"ajax/subtitles-list/",serverSide:!0,columns:[{data:"DT_RowId",responsivePriority:0,className:"text-center",render:function(e,t,a,s){return'<div class="custom-control custom-checkbox mx-auto"><input type="checkbox" class="custom-control-input" id="row-'+s.row+'" value="'+e+'"><label class="custom-control-label" for="row-'+s.row+'"></label></div>'}},{data:"file_name",responsivePriority:1,render:function(e,t,a,s){return'<a href="'+a.link+'">'+e+"</a>"}},{data:"language",className:"text-center"},{data:"name"},{data:"host"},{data:"added",className:"text-right"},{data:"updated",className:"text-right"},{data:"id",className:"text-center",responsivePriority:2,render:function(e,t,a){return'<div class="btn-group">'+btnCog()+'<div class="dropdown-menu dropdown-menu-right border-0 shadow"><button type="button" class="dropdown-item rename" data-id="'+e+'" data-name="'+a.file_name+'"><i class="fas fa-edit mr-2"></i>Rename</button><a href="'+a.link+'" class="dropdown-item" download><i class="fas fa-download mr-2"></i>Download</a>'+btnDeleteItem(e,a.file_name)+"</div></div>"}}],columnDefs:[{orderable:!1,targets:[0,7]},{visible:!0,targets:[0,1,7],className:"noVis"}],order:[[6,"desc"]],drawCallback:function(e){loadTooltip(),$("#tbSubtitles button.delete").click((function(){subtitles.delete.single($(this))})),$("#tbSubtitles button.rename").click((function(){subtitles.rename($(this))}))}})},reload:function(){$("#ckAllSubtitles, #ckAllSubtitles1").prop("checked",!1),$("#toolbar .btn-hidden").addClass("d-none"),$("#tbSubtitles").DataTable().ajax.reload(null,!1)},upload:function(){$("#mdUploadSubtitle").modal("show"),$("#frmUploadSubtitle").on("submit",(function(e){e.preventDefault();var t=new FormData(this),a=$("#frmUploadSubtitle"),s=a.find('input[type="file"]'),n=$(this).find('button[type="submit"]');document.getElementById("uploadSubFile").files.length>0?$.ajax({type:"POST",url:subtitles.url,contentType:!1,processData:!1,cache:!1,data:t,beforeSend:function(){n.prop("disabled",!0)},complete:function(){n.prop("disabled",!1),s.val(""),s.val(null),a.find('label[for="uploadSubFile"]').text(s.attr("placeholder"))},success:function(e){"fail"!==e.status?(subtitles.reload(),showToast(e.message,"success")):showToast(e.message,"error")},error:function(){showToast("Server cannot be accessed. Please contact admins!","error")}}):showToast("Insert the Subtitle File first!","error")}))}},sessions={url:adminURL+"ajax/sessions/",delete:{ajax:function(e,t,a){ajaxPOST(sessions.url,{id:e,action:"delete"},t,a)},single:function(e){void 0!==e&&swal({title:"Are you sure?",text:"Delete '"+e.data("name")+"' session. "+notRecovered(),type:"warning",showLoaderOnConfirm:!0,showCancelButton:!0,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-danger",closeOnConfirm:!1},(function(t){t&&sessions.delete.ajax(e.data("id"),(function(e){"fail"!==e.status?(sessions.reload(),swalSuccess(e.message)):swalError(e.message)}),(function(e){swalError(e.responseText)}))}))},multi:function(){var e=[],t=[],a=[];if($("#ckAllSessions, #ckAllSessions1").prop("checked",!1),$("#tbSessions tbody input[type=checkbox]:checked").each((function(){e.push($(this).val())})),e.length>0){var s=function(s,o){var i,l=o+1;"fail"!==s.status?t.push(e[o]):a.push(e[o]),(i=t.length+a.length)>=e.length?(sessions.reload(),a.length>0?swalInfo(t.length+" user sessions were successfully deleted and "+a.length+" other user sessions failed to be deleted."):swalSuccess("These "+i+" user sessions have been successfully deleted.")):n(e[l],l)},n=function(e,t){sessions.delete.ajax(e,(function(e){s(e,t)}),(function(e){s({status:"fail"},t)}))};swal({title:"Are you sure?",text:"You will delete "+e.length+" user sessions. "+notRecovered(),type:"warning",showLoaderOnConfirm:!0,showCancelButton:!0,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-danger",closeOnConfirm:!1},(function(t){t&&n(e[0],0)}))}else swalWarning("Please check the user sessions you want to delete first.")}},list:function(){$("#tbSessions").length&&$("#tbSessions").DataTable({ajax:adminURL+"ajax/sessions-list/",serverSide:!0,columns:[{data:"id",responsivePriority:0,className:"text-center",render:function(e){return'<div class="custom-control custom-checkbox mx-auto"><input type="checkbox" class="custom-control-input" id="row-'+e+'" value="'+e+'"><label class="custom-control-label" for="row-'+e+'"></label></div>'}},{data:"username",responsivePriority:1},{data:"ip",responsivePriority:2},{data:"useragent",render:function(e){return'<div contentEditable="true" class="title">'+e+"</div>"}},{data:"created",className:"text-right"},{data:"expired",className:"text-right"},{data:"id",className:"text-center",responsivePriority:3,render:function(e,t,a){return'<button data-id="'+e+'" data-name="'+a.username+'" data-toggle="tooltip" title="Delete" type="button" class="btn btn-danger btn-sm delete"><i class="fas fa-trash"></i></button>'}}],columnDefs:[{orderable:!1,targets:[0,6]},{visible:!0,targets:[0,1,2],className:"noVis"}],order:[[5,"desc"]],drawCallback:function(e){loadTooltip(),$("#tbSessions button.delete").click((function(){sessions.delete.single($(this))}))}})},reload:function(){$("#ckAllSessions, #ckAllSessions1").prop("checked",!1),$("#toolbar .btn-hidden").addClass("d-none"),$("#tbSessions").DataTable().ajax.reload(null,!1)}},users={url:adminURL+"ajax/users/",profileURL:adminURL+"ajax/profile/",delete:function(e){void 0!==e&&swal({title:"Are you sure?",text:"Delete the user with the username '"+e.data("name")+"'. "+notRecovered(),type:"warning",showLoaderOnConfirm:!0,showCancelButton:!0,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-danger",closeOnConfirm:!1},(function(t){t&&ajaxPOST(users.url,{id:e.data("id"),action:"delete"},(function(e){"fail"!==e.status?($("#tbUsers").DataTable().ajax.reload(null,!1),swalSuccess(e.message)):swalError(e.message)}),(function(e){swalError(e.responseText)}))}))},list:function(){$("#tbUsers").length&&$("#tbUsers").DataTable({ajax:adminURL+"ajax/users-list/",serverSide:!0,columns:[{data:"name",responsivePriority:0},{data:"user"},{data:"email"},{data:"status",className:"text-center",render:function(e,t,a){var s="Inactive",n="fa-times-circle text-danger";return 1===e?(s="Active",n="fa-check-circle text-success"):2===e&&(s="Need Approval",n="fa-question-circle text-info"),'<i class="fas fa-lg '+n+'" data-toggle="tooltip" title="'+s+'"></i>'}},{data:"added",className:"text-right"},{data:"updated",className:"text-right"},{data:"role"},{data:"videos",className:"text-right"},{data:"id",className:"text-center",responsivePriority:1,render:function(e,t,a){return'<div class="btn-group">'+btnCog()+'<div class="dropdown-menu dropdown-menu-right border-0 shadow">'+btnEditItem(adminURL+"users/edit/?id="+e)+btnDeleteItem(a.id,a.name)+"</div></div>"}}],columnDefs:[{orderable:!1,targets:[7,8]},{visible:!0,targets:[0,8],className:"noVis"}],order:[[4,"desc"]],drawCallback:function(e){loadTooltip(),$("#tbUsers button.delete").click((function(){users.delete($(this))}))}})},changeEmail:function(e){void 0!==e&&""!==e&&ajaxPOST(users.profileURL,{action:"editEmail",email:e},(function(e){"fail"!==e.status?(swalSuccess(e.message),location.href=adminURL+"login/"):swalError(e.message)}),(function(e){swalError(e.responseText)}))},changeUsername:function(e){void 0!==e&&""!==e&&ajaxPOST(users.profileURL,{action:"editUsername",user:e},(function(e){"fail"!==e.status?(swalSuccess(e.message),location.href=adminURL+"login/"):swalError(e.message)}),(function(e){swalError(e.responseText)}))}},videos={url:adminURL+"ajax/videos/",alternatives:{add:function(e){var t=$("#altWrapper"),a=t.find(".input-group").length,s='<div class="form-group" data-index="'+a+'"><div class="input-group"><input type="url" id="altLink-'+a+'" name="altLinks[]" class="form-control" placeholder="Insert alternative video url here" value="'+(void 0!==e?e:"")+'"><div class="input-group-append"><button type="button" data-toggle="tooltip" title="Remove Alternative Video URL" class="btn btn-danger" onclick="videos.alternatives.remove('+a+')"><i class="fas fa-minus"></i></button><a href="javascript:void(0)" data-toggle="tooltip" title="Move" class="btn btn-outline-secondary move"><i class="fas fa-expand-arrows-alt"></i></a></div></div></div>';t.prepend(s),loadTooltip()},remove:function(e){$('#altWrapper .form-group[data-index="'+e+'"]').remove(),$('body > [role="tooltip"]').remove()},get:function(e){var t=e.next(".dropdown-menu");t.hasClass("show")||ajaxPOST(videos.url,{action:"get_alternatives",id:e.data("id")},(function(a){if("fail"!==a.status){var s="Direct Link",n="direct";t.html(""),$.each(a.result,(function(t,a){""!==a.host&&void 0!==vidHosts[a.host]&&("direct"===a.host?a.url.indexOf(".m3u")>-1||a.url.indexOf("hls")>-1?(n="m3u",s="HLS Link"):a.url.indexOf(".mpd")>-1||a.url.indexOf("mpd")>-1?(n="mpd",s="MPEG-DASH Link"):(n=a.host,s=vidHosts[a.host]):(n=a.host,s=vidHosts[a.host]),e.next(".dropdown-menu.show").append('<a class="dropdown-item" href="'+a.url+'" target="_blank"><img src="'+imgCDNURL+"assets/img/logo/"+n+'.png" width="16" height="16" class="mr-2">'+s.replace("|Additional Host","").replace("|New","")+"</a>"))}))}else swalError(a.message)}),(function(e){swalError("Failed to fetch data from server! Please contact the admin.")}))}},cache:{clear:{ajax:function(e,t,a){ajaxPOST(baseURL+"admin-api/",{id:e,action:"clear_video_cache",token:Cookies.get("adv_token",main.cookieConfig)},t,a)},single:function(e){void 0!==e&&videos.cache.clear.ajax(e.data("id"),(function(e){"fail"!==e.status?swalSuccess(e.message):swalError(e.message)}),(function(e){swalError(e.responseText)}))},multi:function(e){var t=[],a=[],s=[];if($("#ckAllVideos, #ckAllVideos1").prop("checked",!1),$("#tbVideos tbody input[type=checkbox]:checked").each((function(){t.push($(this).val())})),t.length>0){var n=function(e,n){var i,l=n+1;"fail"!==e.status?a.push(t[n]):s.push(t[n]),(i=a.length+s.length)>=t.length?s.length>0?swalInfo("Cache of "+a.length+" videos was successfully cleared and cache of "+s.length+" other videos failed to clear."):swalSuccess("These "+i+" videos have been successfully deleted."):o(t[l],l)},o=function(e,t){videos.cache.clear.ajax(e,(function(e){n(e,t)}),(function(e){n({status:"fail"},t)}))};swal({title:"Are you sure?",text:"You will clear the stored cache of "+t.length+" videos.",type:"warning",showLoaderOnConfirm:!0,showCancelButton:!0,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-danger",closeOnConfirm:!1},(function(e){e&&o(t[0],0)}))}else swalWarning("Please check the videos you want to clear cache stored first.")}}},checker:{multi:function(e){var t=$("#tbVideos tbody"),a=t.find("input[type=checkbox]:checked"),s=function(e,t,s){ajaxPOST(videos.url,{action:"update_status",id:e,sources:t},(function(e){n($(a[s]).val(),s)}),(function(e){n($(a[s]).val(),s)}))},n=function(t,o){var i=o+1;o<=a.length?ajaxPOST(videos.url,{action:"get_server",id:t,source:"db"},(function(e){"fail"!==e.status?function(e,t,o){ajaxGET(e,(function(e){"fail"!==e.status?s(t,e.sources,o):s(t,[],o)}),(function(e){n($(a[o]).val(),o)}))}(e.result,t,i):n($(a[i]).val(),i)}),(function(e){n($(a[i]).val(),i)})):(videos.reload(),e.prop("disabled",!1))};a.length>0?(e.prop("disabled",!0),a.each((function(e,a){t.find("#status-"+$(this).val()).attr("class","fas fa-spin fa-lg fa-sync-alt text-info")})),n($(a[0]).val(),0)):swalWarning("Please select the video you want to check!")}},delete:{ajax:function(e,t,a){ajaxPOST(videos.url,{id:e,action:"delete"},t,a)},single:function(e){if(void 0!==e){var t=e.data("id"),a=e.data("name");swal({title:"Are you sure?",text:"Delete the '"+a+"' video. "+notRecovered(),type:"warning",showCancelButton:!0,showLoaderOnConfirm:!0,closeOnConfirm:!1,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-danger"},(function(e){e&&videos.delete.ajax(t,(function(e){"fail"!==e.status?(videos.reload(),swalSuccess(e.message)):swalError(e.message)}),(function(e){swalError(e.responseText)}))}))}},multi:function(e){var t=[],a=[],s=[];if($("#ckAllVideos, #ckAllVideos1").prop("checked",!1),$("#tbVideos tbody input[type=checkbox]:checked").each((function(){t.push($(this).val())})),t.length>0){var n=function(e,n){var i,l=n+1;"fail"!==e.status?a.push(t[n]):s.push(t[n]),(i=a.length+s.length)>=t.length?(videos.reload(),s.length>0?swalInfo(a.length+" videos were successfully deleted and "+s.length+" other videos failed to be deleted."):swalSuccess("These "+i+" videos have been successfully deleted.")):o(t[l],l)},o=function(e,t){videos.delete.ajax(e,(function(e){n(e,t)}),(function(e){n({status:"fail"},t)}))};swal({title:"Are you sure?",text:"You will delete "+t.length+" videos. "+notRecovered(),type:"warning",showLoaderOnConfirm:!0,showCancelButton:!0,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-danger",closeOnConfirm:!1},(function(e){e&&o(t[0],0)}))}else swalWarning("Please check the videos you want to delete first.")}},subtitles:{autocomplete:{minLength:3,source:function(e,t){$.ajax({url:videos.url,type:"POST",data:{action:"search_subtitles",q:e.term},success:function(e){t(e)}})},select:function(e,t){}},edit:function(e,t,a){var s=$("#mdEditSubtitle");s.find("#editSubId").val(e),s.find("#editSubURL").val(a),s.find("#editSubLang").val(t),s.find("#editSubFile").val(""),s.find("#editSubFile").val(null),s.find('label[for="editSubFile"]').text(s.find("#editSubFile").attr("placeholder")),s.find("#editSubType").val("url"),s.find("#fgEditSubURL").removeClass("d-none"),s.find("#fgEditSubFile").addClass("d-none"),s.modal("show")},delete:function(e,t){swal({title:"Are you sure?",text:"Are you sure you want to delete the "+t+" subtitle?",type:"warning",showLoaderOnConfirm:!0,showCancelButton:!0,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-danger",closeOnConfirm:!0},(function(t){t&&ajaxPOST(videos.url,{action:"delete_subtitle",id:e},(function(t){"fail"!==t.status?($('[data-sub="'+e+'"]').remove(),showToast(t.message,"success")):showToast(t.message,"error")}),(function(e){showToast(e.responseText,"error")}))}))},add:function(){var e=$("#subsWrapper"),t=e.find(".input-group"),a='<div class="form-group" data-index="'+t.length+'"><div class="input-group"><div class="input-group-prepend">'+subtitles.html("lang[]")+'<input type="hidden" id="sub-type-'+t.length+'" name="sub-type[]" value="url"></div><input type="url" id="sub-url-'+t.length+'" name="sub-url[]" class="form-control subtitle" placeholder="Subtitle URL"><div class="input-group-append"><button type="button" class="btn btn-outline-primary" data-toggle="tooltip" aria-label="Upload Subtitle" onclick="videos.subtitles.upload($(this))" data-index="'+t.length+'" title="Upload Subtitle"><i class="fas fa-upload"></i></button><button type="button" class="btn btn-outline-danger" data-toggle="tooltip" title="Remove Subtitle" data-index="'+t.length+'" aria-label="Remove Subtitle" onclick="videos.subtitles.remove($(this))"><i class="fas fa-minus"></i></button></div></div></div>';loadTooltip(),e.append(a);var s=$("#sub-url-"+t.length),n=videos.subtitles.autocomplete;n.select=function(e,t){s.prev().find("select").val(t.item.label).trigger("change")},s.searchSubtitle(n),$(".select2").select2({theme:"bootstrap4"})},remove:function(e){$('#subsWrapper .form-group[data-index="'+e.data("index")+'"]').remove()},upload:function(e){var t=e.closest(".input-group");t.find("#sub-type-"+e.data("index")).val("file"),t.find("input.subtitle").replaceWith('<div class="custom-file"><input type="file" id="sub-'+e.data("index")+'" name="sub-file[]" class="custom-file-input subtitle" accept=".srt, .vtt, .ass, .sub, .stl, .dfxp, .ttml, .sbv, .txt"><label class="custom-file-label" for="sub-'+e.data("index")+'">Choose file</label></div>'),e.replaceWith('<button type="button" class="btn btn-outline-primary" data-toggle="tooltip" title="Insert Subtitle URL" aria-label="Upload Subtitle" onclick="videos.subtitles.insertURL($(this))" data-index="'+e.data("index")+'"><i class="fas fa-link"></i></button>'),loadTooltip(),bsCustomFileInput.init()},insertURL:function(e){var t=e.closest(".input-group");t.find("#sub-type-"+e.data("index")).val("url"),t.find(".custom-file").replaceWith('<input type="url" id="sub-url-'+e.data("index")+'" name="sub-url[]" class="form-control subtitle" placeholder="Subtitle URL">'),e.replaceWith('<button type="button" class="btn btn-outline-primary" data-toggle="tooltip" title="Upload Subtitle" aria-label="Upload Subtitle" onclick="videos.subtitles.upload($(this))" data-index="'+e.data("index")+'"><i class="fas fa-upload"></i></button>'),loadTooltip();var a=$("#sub-url-"+e.data("index")),s=videos.subtitles.autocomplete;s.select=function(e,t){a.prev().find("select").val(t.item.label)},a.searchSubtitle(s)},get:function(e){var t=e.next(".dropdown-menu");t.hasClass("show")||ajaxPOST(videos.url,{action:"get_subtitles",id:e.data("id")},(function(a){"fail"!==a.status?(t.html(""),$.each(a.result,(function(t,a){e.next(".dropdown-menu.show").append('<a class="dropdown-item" href="'+a.url+'" target="_blank">'+a.name+"</a>")}))):swalError(a.message)}),(function(e){swalError("Failed to fetch data from server! Please contact the admin.")}))}},bulk:{get_embed:function(){var e=$("#tbBulkVideos tbody input[type=checkbox]:checked"),t="",a=[];e.length>0?e.each((function(s,n){t+=$(this).data("title")+"\t"+$(this).data("embed"),t+="\n\n",a.push(n),a.length>=e.length&&copyText(t.trim(),"Embed URLs")})):showToast("Select the file you want to copy the embed url!","error")},save:function(e){var t=$("#frmBulkVideo"),a=$("#btnGetEmbedURLs"),s=t.find("#links"),n=s.val().trim().split("\n"),o=$("#tbBulkVideos").DataTable({responsive:!0,paging:!1,info:!1,searching:!1,columns:[{width:"10%",responsivePriority:0,className:"text-center"},{responsivePriority:1,render:function(e){return'<div class="title" contentEditable="true">'+e+"</div>"}},{responsivePriority:2,className:"text-center"},{responsivePriority:3,className:"text-center"}],columnDefs:[{orderable:!1,targets:[0,3]},{visible:!0,targets:[0,1],className:"noVis"}],order:[[1,"asc"]],drawCallback:function(){loadTooltip()}}),i=function(e){var t="copyText('"+n[e]+"', 'Source Link')",a=[];return a.push('<div class="custom-control custom-checkbox mx-auto"><input type="checkbox" class="custom-control-input" id="bulk-'+e+'" value="'+e+'"><label class="custom-control-label" for="bulk-'+e+'"></label></div>'),a.push(n[e]),a.push('<div class="text-center"><i class="fas fa-lg fa-times-circle text-danger" data-toggle="tooltip" title="Failed"></i></div>'),a.push('<div class="btn-group"><button type="button" class="btn btn-sm btn-custom dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fas fa-cog"></i></button><div class="dropdown-menu dropdown-menu-right border-0 shadow"><a class="dropdown-item" href="javascript:void(0)" onclick="'+t+'">Copy Source Link</a></div></div>'),a},l=function(e,t){var a=t-1,s=n[t],l=function(){o.row.add(i(a)).columns.adjust().draw(),r(s,t)};e?ajaxGET(e,(function(e){"fail"!==e.status?(o.row.add(function(e,t){var a,s,o=[];return a="copyText('"+t.embed_link+"', 'Embed Link')",s="copyText('"+n[e]+"', 'Source Link')",o.push('<div class="custom-control custom-checkbox mx-auto"><input type="checkbox" class="custom-control-input" id="bulk-'+e+'" value="'+e+'" data-title="'+t.title+'" data-embed="'+t.embed_link+'"><label class="custom-control-label" for="bulk-'+e+'"></label></div>'),o.push(t.title),o.push('<div class="text-center"><i class="fas fa-lg fa-check-circle text-success" data-toggle="tooltip" title="Success"></i></div>'),o.push('<div class="btn-group"><button type="button" class="btn btn-sm btn-custom dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fas fa-cog"></i></button><div class="dropdown-menu dropdown-menu-right border-0 shadow"><a class="dropdown-item" href="javascript:void(0)" onclick="'+a+'">Copy Embed Link</a><a class="dropdown-item" href="javascript:void(0)" onclick="'+s+'">Copy Source Link</a></div></div>'),o}(a,e)).columns.adjust().draw(),r(s,t)):l()}),(function(e){l()})):(o.row.add(i(a)).columns.adjust().draw(),r(s,t))},r=function(t,o){var i=o+1;i<=n.length?ajaxPOST(videos.url,{action:"get_server",id:t,useTitleAsSlug:$("#useTitleAsSlug").prop("checked")},(function(e){l(e.result,i)}),(function(e){l(null,i)})):(s.val(""),s.prop("disabled",!1),e.find("i").attr("class","fas fa-save mr-2"),e.prop("disabled",!1),a.prop("disabled",!1),videos.reload())};n.length>0?(a.prop("disabled",!0),o.clear().draw(),e.find("i").attr("class","fas fa-spin fa-sync-alt mr-2"),e.prop("disabled",!0),s.prop("disabled",!0),r(n[0],0)):swalWarning("Video URL is required!")}},removePoster:function(e,t){void 0!==e&&""!==e&&(t.prop("disabled",!0),ajaxPOST(videos.url,{action:"remove_poster",id:e},(function(e){"fail"!==e.status?(t.closest(".form-group").remove(),showToast(e.message,"success")):showToast(e.message,"error"),t.prop("disabled",!1)}),(function(e){showToast("Poster failed to delete. Insert a new poster if you want to replace it!","error")})))},scrollToHosts:function(){$("#collapseSites").collapse("show"),$("html,body").animate({scrollTop:$("#collapseSites").offset().top},"slow")},list:function(){$("#tbVideos").length&&$("#tbVideos").DataTable({ajax:adminURL+"ajax/videos-list/?status="+$_GET("status")+"&dmca="+$_GET("dmca"),serverSide:!0,columns:[{data:"id",responsivePriority:0,className:"text-center",render:function(e,t,a,s){return btnCheckbox(e,"videos")}},{data:"title",responsivePriority:1,render:function(e,t,a,s){var n,o="";return""===e&&(e="(No Title)"),n='<div class="d-block"><img data-src="'+a.poster_url+'" class="img-thumbnail d-none" style="max-width:200px" alt="'+e+'"></div>',o='<div class="title" contentEditable="true" data-toggle="tooltip" title="'+e+'">'+e+"</div>",""!==a.poster&&null!==a.poster&&(o=n+o),o}},{data:"host",className:"text-center",render:function(e,t,a,s){return a.alt_count>0?'<div class="dropdown"><button class="btn btn-outline-default btn-sm dropdown-toggle alt" type="button" data-toggle="dropdown" aria-expanded="false" data-id="'+a.id+'"><img src="'+imgCDNURL+"assets/img/logo/"+e+'.png" width="16" height="16"></button><div class="dropdown-menu shadow border-0" style="max-height:240px"></div></div>':'<a href="'+a.link+'" target="_blank" title="'+(void 0!==vidHosts[e]?vidHosts[e]:e).replace("|Additional Host","").replace("|New","")+'" data-toggle="tooltip"><img src="'+imgCDNURL+"assets/img/logo/"+e+'.png" width="16" height="16"></a>'}},{data:"status",className:"text-center",render:function(e,t,a,s){var n="check",o="success",i="Good";return 2==e?(n="minus",o="warning",i="Warning"):1==e&&(n="times",o="danger",i="Broken"),'<i class="fas fa-lg fa-'+n+"-circle text-"+o+' status" data-toggle="tooltip" id="status-'+a.id+'" title="'+i+'"></i>'}},{data:"dmca",className:"text-center",render:function(e,t,a,s){return 1==e?'<i class="fas fa-lg fa-ban text-danger dmca" data-toggle="tooltip" title="Takedown"></i>':""}},{data:"sub_count",className:"text-center",render:function(e,t,a,s){return parseInt(e)>0?'<div class="dropdown"><a class="btn btn-outline-primary btn-sm dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" onclick="videos.subtitles.get($(this))" data-id="'+a.id+'"><i class="fas fa-lg fa-language"></i></a><div class="dropdown-menu shadow border-0" style="max-height:240px"></div></div>':""}},{data:"views",className:"text-right"},{data:"name"},{data:"added",className:"text-right"},{data:"updated",className:"text-right"},{data:"id",className:"text-center",responsivePriority:2,render:function(e,t,a){var s=0==a.dmca?"Takedown":"Cancel Takedown";return'<div class="btn-group">'+btnCog()+'<div class="dropdown-menu dropdown-menu-right border-0 shadow">'+btnCopyEmbed(a.actions.embed_code)+btnEmbed(a.actions.embed)+btnDownload(a.actions.download)+'<div class="dropdown-divider"></div>'+btnEditItem(adminURL+"videos/edit/?id="+e)+btnDeleteItem(e,a.title)+'<button data-id="'+e+'" class="dropdown-item clear" type="button"><i class="fas fa-eraser mr-2"></i>Clear Cache</button>'+(0===uRole?'<div class="dropdown-divider"></div><button onclick="videos.dmca($(this))" data-id="'+e+'" class="dropdown-item" type="button"><i class="fas fa-ban mr-2"></i>'+s+"</button>":"")+"</div></div>"}}],columnDefs:[{orderable:!1,targets:[0,5,10]},{visible:!0,targets:[0,1,10],className:"noVis"}],order:[[8,"desc"]],drawCallback:function(e){loadTooltip(),videos.showHideThumbnail($("#shThumbnail").prop("checked")),$("#tbVideos button.alt").click((function(){videos.alternatives.get($(this))})),$("#tbVideos button.clear").click((function(){videos.cache.clear.single($(this))})),$("#tbVideos button.delete").click((function(){videos.delete.single($(this))})),$("#tbVideos button.copy-embed").click((function(){copyText($(this).data("text"),"Embed")}))}})},reload:function(){$("#ckAllVideos, #ckAllVideos1").prop("checked",!1),$("#toolbar .btn-hidden").addClass("d-none"),$("#tbVideos").DataTable().ajax.reload(null,!1)},dmca:function(e){e.prop("disabled",!0),ajaxPOST(videos.url,{action:"dmca_takedown",id:e.data("id")},(function(t){"fail"!==t.status?(videos.reload(),swalSuccess(t.message)):swalError(t.message),e.prop("disabled",!1)}),(function(t){swalError("Failed to fetch data from server! Please contact the admin."),e.prop("disabled",!1)}))},init:function(){if(videos.list(),void 0!==$.ui&&$.widget("custom.searchSubtitle",$.ui.autocomplete,{_renderItem:function(e,t){return $("<li>").append('<strong>File Name: <span class="text-success">'+t.id+'</span><br>Language: <span class="text-primary">'+t.label+"</span></strong>").appendTo(e)}}),void 0!==$.fn.searchSubtitle){var e=videos.subtitles.autocomplete;e.select=function(e,t){$("#sub-lang-0").val(t.item.label)},$("#sub-url-0").searchSubtitle(e)}$("#mdEditSubtitle").detach().appendTo("body"),$("#frmEditSubtitle").on("submit",(function(e){if(e.preventDefault(),e.stopPropagation(),!1!==this.checkValidity()){var t=$("#mdEditSubtitle"),a=new FormData(this),s=$(this).find('button[type="submit"]'),n=$("#editSubType").val();document.getElementById("editSubFile").files.length>0&&"file"===n||"url"===n?$.ajax({type:"POST",url:videos.url,contentType:!1,processData:!1,cache:!1,data:a,beforeSend:function(){s.prop("disabled",!0)},complete:function(){s.prop("disabled",!1)},success:function(e){if("fail"!==e.status){var a=$('.ui-sortable-handle[data-sub="'+e.result.id+'"]'),s="videos.subtitles.edit("+e.result.id+", '"+e.result.lang+"', '"+e.result.sub+"')";a.find(".float-left a").attr("href",e.result.sub).text(e.result.lang),a.find(".float-right a:first-child").attr("onclick",s),t.modal("hide"),showToast(e.message,"success")}else showToast(e.message,"error")},error:function(){showToast("Server cannot be accessed. Please contact admins!","error")}}):showToast("Insert the Subtitle URL/File first!","error")}else $(this).addClass("was-validated")})),$("#mdEditSubtitle").on("hidden.bs.modal",(function(){$("#frmEditSubtitle")[0].reset()})),$("#frmBulkVideo #links").blur((function(){""!==$(this).val()?$("#btnBulkSave").prop("disabled",!1):$("#btnBulkSave").prop("disabled",!0)})),$("#mdVideosBulkLink").detach().appendTo("body"),$("#mdVideosBulkLink").on("hidden.bs.modal",(function(){var e=$("#frmBulkVideo");e.find("#links").val(""),e.find("#useTitleAsSlug").prop("checked",!1),$("#tbBulkVideos").DataTable().clear().draw()})),$("#ckAllBulkVideos, #ckAllBulkVideos1").change((function(){var e=$("#tbBulkVideos tbody input.custom-control-input");$(this).prop("checked")?e.prop("checked",!0):e.prop("checked",!1)})),void 0!==$.fn.sortable&&($("#subtitles").sortable(),$("#altWrapper").sortable({handle:".move"})),$(".btn-upload-poster").click((function(){$("#posterUpload").toggleClass("d-none"),$("#posterURL").toggleClass("d-none")}))},showHideThumbnail:function(e){var t=$("#tbVideos img.img-thumbnail");e?(t.each((function(e){$(this).attr("src",$(this).data("src"))})),t.removeClass("d-none")):t.addClass("d-none")},gdrive_files:{delete:function(e){swal({title:"Are you sure?",text:"Delete the '"+e.data("name")+"' mirror file.",type:"warning",showLoaderOnConfirm:!0,showCancelButton:!0,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-danger",closeOnConfirm:!1},(function(t){t&&ajaxPOST(gdrive_files.url,{id:e.data("id"),action:"delete_mirror"},(function(t){"fail"!==t.status?(e.closest("li").remove(),swalSuccess(t.message)):swalError(t.message)}),(function(e){swalError(e.responseText)}))}))}}},player={alternative:{add:function(){swal({title:"Info",text:"You can add some alternative video urls from the user page!",type:"info",showCancelButton:!0,confirmButtonClass:"btn-primary",confirmButtonText:"OK",cancelButtonClass:"btn-danger",cancelButtonText:"Cancel",closeOnConfirm:!0,closeOnCancel:!0},(function(e){e&&(location.href="videos/new/")}))}},subtitle:{upload:function(e){var t=e.closest(".input-group"),a=e.data("index");t.find("#sub-type-"+a).val("file"),t.find("input.subtitle").replaceWith('<div class="custom-file"><input type="file" id="sub-'+a+'" name="sub-file[]" class="custom-file-input subtitle" accept=".srt, .vtt, .ass, .sub, .stl, .dfxp, .ttml, .sbv, .txt"><label class="custom-file-label" for="sub-'+a+'">Choose file (.srt, .vtt, .ass, .sub, .stl, .dfxp, .ttml, .sbv, .txt)</label></div>'),e.replaceWith('<button type="button" class="btn btn-outline-primary" data-toggle="tooltip" title="Insert Subtitle URL" aria-label="Upload Subtitle" onclick="player.subtitle.insert($(this))" data-index="'+a+'"><i class="fas fa-link"></i></button>'),loadTooltip(),bsCustomFileInput.init()},insert:function(t){var a=t.closest(".input-group"),s=t.data("index");a.find("#sub-type-"+s).val("url"),a.find(".custom-file").replaceWith('<input type="text" name="sub-url[]" class="form-control subtitle" placeholder="Subtitle URL (.srt, .vtt, .ass, .sub, .stl, .dfxp, .ttml, .sbv, .txt)">'),e.replaceWith('<button type="button" class="btn btn-outline-primary" data-toggle="tooltip" title="Upload Subtitle" aria-label="Upload Subtitle" onclick="player.subtitle.upload($(this))" data-index="'+s+'"><i class="fas fa-upload"></i></button>'),loadTooltip()},add:function(){var e=$("#subsWrapper"),t=e.find(".form-group"),a='<div class="form-group" data-index="'+t.length+'"><div class="input-group"><div class="input-group-prepend">'+subtitles.html("lang[]")+'<input type="hidden" id="sub-type-'+t.length+'" name="sub-type[]" value="url"></div><input type="text" name="sub-url[]" class="form-control subtitle" placeholder="Subtitle URL (.srt, .vtt, .ass, .sub, .stl, .dfxp, .ttml, .sbv, .txt)"><div class="input-group-append"><button type="button" class="btn btn-outline-primary" data-toggle="tooltip" aria-label="Upload Subtitle" onclick="player.subtitle.upload($(this))" data-index="'+t.length+'" title="Upload Subtitle"><i class="fas fa-upload"></i></button><button type="button" class="btn btn-outline-danger" data-toggle="tooltip" title="Remove Subtitle" data-index="'+t.length+'" aria-label="Remove Subtitle" onclick="player.subtitle.remove($(this))"><i class="fas fa-minus"></i></button></div></div></div>';e.find(".form-group").length<10?e.append(a):swalWarning("Only 10 subtitles are allowed."),loadTooltip()},remove:function(e){$('#subsWrapper .form-group[data-index="'+e.data("index")+'"]').remove()}}};function gdriveViewLink(e){return'<a href="https://drive.google.com/file/d/'+e+'/view?usp=drivesdk" target="_blank">'+e+"</a>"}function updateNow(){$.ajax({url:"ajax/?action=updateNow",timeout:3e5})}function searchHost(e){$("#tbHost tbody tr").each((function(t,a){$(a).data("host").toLowerCase().indexOf(e)>-1||$(a).html().toLowerCase().indexOf(e)>-1?$(a).removeClass("d-none"):$(a).addClass("d-none")}))}function swalSuccess(e){swal("Success!",e,"success")}function swalError(e){swal("Error!",e,"error")}function swalInfo(e){swal("Info!",e,"info")}function swalWarning(e){swal("Warning!",e,"warning")}function ajaxValidation(e,t){var a=document.querySelector(e);""!==t?a.setAttribute("data-error-ajax",t):a.removeAttribute("data-error-ajax"),a.setCustomValidity(t)}function matchValidation(e,t){var a=document.querySelector(e);""!==t?a.setAttribute("data-error-match",t):a.removeAttribute("data-error-match"),a.setCustomValidity(t)}function multiSelectOptions(){var e="<input type='search' class='form-control form-control-sm' autocomplete='off' placeholder='Search'>";return{keepOrder:!0,selectableHeader:e,selectionHeader:e,afterInit:function(e){var t=this,a="#"+t.$container.attr("id"),s=t.$selectableUl.prev(),n=t.$selectionUl.prev(),o=a+" .ms-elem-selectable:not(.ms-selected)",i=a+" .ms-elem-selection.ms-selected";s.on("blur keyup",(function(e){var t=$(this).val().toLowerCase();""!==t?$(o).each((function(){$(this).text().toLowerCase().indexOf(t)>-1?$(this).removeClass("d-none"):$(this).addClass("d-none")})):$(o).removeClass("d-none")})),n.on("blur keyup",(function(e){var t=$(this).val().toLowerCase();""!==t?$(i).each((function(){$(this).text().toLowerCase().indexOf(t)>-1?$(this).removeClass("d-none"):$(this).addClass("d-none")})):$(i).removeClass("d-none")}))}}}function copyText(e,t){var a=document.createElement("textarea");a.textContent=e,document.body.appendChild(a);var s=document.createRange();s.selectNode(a);var n=document.getSelection();n.removeAllRanges(),n.addRange(s),console.log("copy success",document.execCommand("copy")),n.removeAllRanges(),document.body.removeChild(a),showToast((t=void 0!==t&&""!==t&&null!==t?t:"Embed code")+" has been copied.","success")}function loadTooltip(){$('[data-toggle="tooltip"], [data-tooltip="true"]').tooltip({container:"body"}),$('[data-toggle="tooltip"], [data-tooltip="true"]').on("show.bs.tooltip",(function(){$('body > [role="tooltip"]').remove()}))}function loadStyle(e,t){var a=document.createElement("link");a.href=e,a.type="text/css",a.rel="stylesheet",void 0!==t&&(a.onload=t),document.getElementsByTagName("head")[0].appendChild(a)}function require(e,t){var a=document.createElement("script");a.src=e,a.type="text/javascript",void 0!==t&&(a.onload=t),document.getElementsByTagName("head")[0].appendChild(a)}function $_GET(e){e=e.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(window.location.href);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null}function showToast(e,t,a){var s={text:e.replace(/\+/gi," "),duration:5e3,close:!0,gravity:"top",position:"right",stopOnFocus:!0,callback:function(){Cookies.remove("adm-type",main.cookieConfig),Cookies.remove("adm-message",main.cookieConfig)}};$('body div[role="tooltip"]').remove(),"undefined"!=typeof Toastify&&Toastify(Object.assign(s,{info:{style:{background:"linear-gradient(to right, #5477f5, #73a5ff)"}},warning:{style:{background:"linear-gradient(to right, #ff9800, #ffc107)"},className:"text-dark"},danger:{style:{background:"linear-gradient(to right, #e91e63, #f44336)"}},success:{style:{background:"linear-gradient(to right, #009688, #4caf50)"}},error:{style:{background:"linear-gradient(to right, #e91e63, #f44336)"}}}[t],a)).showToast()}function ajaxGET(e,t,a){var s=!(e.indexOf("/api")>-1);$.ajax({url:e,type:"GET",cache:s,success:t,error:a})}function ajaxPOST(e,t,a,s){var n=!(e.indexOf("/api")>-1);$.ajax({url:e,type:"POST",cache:n,data:t,success:a,error:s})}function btnCog(){return'<button type="button" class="btn btn-sm btn-custom dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fas fa-cog"></i></button>'}function btnDownload(e){return'<a class="dropdown-item" href="'+e+'" target="_blank"><i class="fas fa-download mr-2"></i>Download Link</a>'}function btnEmbed(e){return'<a class="dropdown-item" href="'+e+'" target="_blank"><i class="fas fa-link mr-2"></i>Embed Link</a>'}function btnEditItem(e){return'<a href="'+e+'" class="dropdown-item" type="button"><i class="fas fa-edit mr-2"></i>Edit</a>'}function btnCopyEmbed(e){return'<button class="dropdown-item copy-embed" data-text="'+e+'"><i class="fas fa-code mr-2"></i>Copy Embed Code</button>'}function btnDeleteItem(e,t){return'<button class="dropdown-item delete" data-id="'+e+'" data-name="'+t+'" type="button"><i class="fas fa-trash mr-2"></i>Delete</button>'}function notRecovered(){return"Deleted data cannot be recovered."}function btnCheckbox(e,t){return'<div class="custom-control custom-checkbox mx-auto"><input type="checkbox" class="custom-control-input" id="'+t+"-"+e+'" value="'+e+'"><label class="custom-control-label" for="'+t+"-"+e+'"></label></div>'}$(document).ready((function(e){main.init(),e("#modalExtApps").detach().appendTo("body"),dashboard.supportChecker(),dashboard.popularVideos.list(),dashboard.recentVideos.list(),dashboard.chart.videoStatus(".video-status"),dashboard.chart.serverStatus(".server-status");var t=dashboard.chart.views,a=document.querySelector("#views > .chart");if(void 0===t.apex&&null!==a&&(t.apex=new ApexCharts(a,t.options),t.apex.render(),t.load("seven_days")),e('#views input[name="options"]').click((function(){t.load(e(this).val())})),gdrive_accounts.list(),gdrive_files.list(),gdrive_backup_files.list(),gdrive_backup_queue.list(),load_balancers.list(),void 0!==e.fn.multiSelect){var s=Object.assign(multiSelectOptions(),{selectableHeader:"<div class='header'>Enabled Hosts</div>"+main.multiSelectSearch,selectionHeader:"<div class='header'>Disabled Hosts</div>"+main.multiSelectSearch});e("#disallow_hosts").multiSelect(s)}if(void 0!==e.fn.multiSelect){var n=Object.assign(multiSelectOptions(),{selectableHeader:"<div class='header'>Direct Hosts</div>"+main.multiSelectSearch,selectionHeader:"<div class='header'>Bypassed Hosts</div>"+main.multiSelectSearch}),o=Object.assign(multiSelectOptions(),{selectableHeader:"<div class='header'>Enabled Hosts</div>"+main.multiSelectSearch,selectionHeader:"<div class='header'>Disabled Hosts</div>"+main.multiSelectSearch}),i=Object.assign(multiSelectOptions(),{selectableHeader:"<div class='header'>Enabled Resolutions</div>"+main.multiSelectSearch,selectionHeader:"<div class='header'>Disabled Resolutions</div>"+main.multiSelectSearch});e("#bypass_hosts, #bypass_host").multiSelect(n),e("#disable_host").multiSelect(o),e("#disable_resolution").multiSelect(i)}e("#modalCustomVAST").detach().appendTo("body"),e("#frmCreateCustomVast").submit((function(t){t.preventDefault(),ajaxPOST(settings.url,e(this).serialize(),(function(t){"fail"!==t.status?(e("#txtCustomVastResult").val(t.result),swalSuccess(t.message)):swalError(t.message),e("#customVastResult").toggleClass("d-none")}),(function(e){swalError(e.responseText)}))})),e("#frmLicense").submit((function(t){t.preventDefault(),ajaxPOST(settings.url,e(this).serialize(),(function(t){"fail"!==t.status?(swalSuccess(t.message),e("#frmLicense").remove()):swalError(t.message)}),(function(e){swalError(e.responseText)}))})),e("#player").change((function(){"jwplayer_latest"===e(this).val()&&e("#p2p").prop("checked",!1)})),e("#modalHostSub").detach().appendTo("body"),e("#mdUploadSubtitle").detach().appendTo("body"),subtitles.list(),sessions.list(),users.list();var l=e("#frmUser #retype_password"),r=e("#frmUser #password");if(r.change((function(){""!==e(this).val()?(e(this).prop("required",!0),l.prop("required",!0)):(e(this).prop("required",!1),l.prop("required",!1))})),l.change((function(){var t="#frmUser #retype_password";e(this).val()!==r.val()?matchValidation(t,"The confirm new password must be the same as the new password"):matchValidation(t,"")})),videos.init(),e("#frmCreatePlayer").on("submit",(function(t){t.preventDefault();var a=e("#frmCreatePlayer"),s=new FormData(a[0]),n=e(this).find("#submit"),o=n.html(),i=e("#createPlayerResult"),l=e("#captcha-response");n.html('<span class="spinner-border spinner-border-sm" role="status"></span> Loading...').prop("disabled",!0),i.addClass("d-none"),e("#embedIframe").attr("src",""),l.length&&""===l.val()?swal({title:"Error!",text:"Invalid Captcha! Load a new captcha.",type:"warning",showCancelButton:!0,showLoaderOnConfirm:!0,cancelButtonClass:"btn-secondary",confirmButtonClass:"btn-primary",closeOnConfirm:!1},(function(e){e?(grecaptcha.reset(),grecaptcha.execute().then((function(){a.trigger("submit"),swalSuccess("The form has been resubmitted.")}))):n.html(o).prop("disabled",!1)})):(s.append("action","createPlayer"),e.ajax({type:"POST",url:"ajax/",contentType:!1,processData:!1,cache:!1,data:s,complete:function(){n.html(o).prop("disabled",!1)},success:function(t){"fail"!==t.status?(e("#txtEmbed").val(t.result.embed_link),e("#txtEmbedCode").val(t.result.embed_code),e("#txtDl").val(t.result.download_link),e("#txtReq").val(t.result.embed2_link),e("#txtJson").val(t.result.api_link),e("#embedIframe").attr("src",t.result.embed_link),i.removeClass("d-none"),a[0].reset()):(swalError(t.message),l.length&&(grecaptcha.reset(),grecaptcha.execute()))},error:function(e){swalError(e.responseText)}}))})),e("#frmBypassLimit").on("submit",(function(t){t.preventDefault();var a=e("#submit").html(),s=e("#captcha");e.ajax({url:"ajax/",method:"POST",dataType:"json",cache:!1,xhrFields:{withCredentials:!0},data:e(this).serialize(),beforeSend:function(){e("#submit").html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Please wait...').prop("disabled",!0)},complete:function(){e("#submit").html(a).prop("disabled",!1),s.length&&(grecaptcha.reset(),grecaptcha.execute())},success:function(t){"fail"!==t.status?(e("#bypassedLink").val(t.result.link),e("#bypassedLink").attr("data-id",t.result.id),e("#bypassedLinkDL").prop("disabled",!1),swalSuccess(t.message)):swalError(t.message)}})})),e("#frmDownloadGDrive").on("submit",(function(t){t.preventDefault();var a=function(){var t=e("#bypassedLinkDL").html(),a=e("#bypassedLink").data("id"),s="",n=function(){e("#bypassedLinkDL").html(t).prop("disabled",!1),e("#bypassedLinkProgress").addClass("d-none")};e.ajax({url:"ajax/",method:"POST",dataType:"json",xhrFields:{withCredentials:!0},data:e("#frmDownloadGDrive").serialize(),beforeSend:function(){e("#bypassedLinkDL").html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Please wait...').prop("disabled",!0)},success:function(t){"fail"!==t.status?(s=t.result.access_token,e.ajax({type:"GET",url:"https://www.googleapis.com/drive/v3/files/"+a+"?alt=json",headers:{authorization:"Bearer "+s},success:function(t){var o=t.name;e.ajax({url:"https://www.googleapis.com/drive/v3/files/"+a+"?alt=media&source=downloadUrl",method:"GET",headers:{authorization:"Bearer "+s},beforeSend:function(){e("#bypassedLinkProgress").removeClass("d-none")},xhr:function(){var t=new XMLHttpRequest;return t.onreadystatechange=function(){2===t.readyState&&(200===t.status?t.responseType="blob":t.responseType="text")},t.addEventListener("progress",(function(t){if(t.lengthComputable){var a=parseInt(t.loaded/t.total*100);if(e("#bypassedLinkProgress .progress-bar").attr("style","width:"+a+"%").attr("aria-valuenow",a).text(a+"%"),a>=100)var s=setTimeout((function(){n(),clearTimeout(s)}),3e3)}}),!1),t},success:function(t){var a=new Blob([t],{type:"application/octet-stream"});if(!!document.documentMode)window.navigator.msSaveBlob(a,o);else{var s,n=window.URL||window.webkitURL,i=e("<a />");s=n.createObjectURL(a),i.attr("download",o),i.attr("href",s),e("body").append(i),i[0].click(),e("body").remove(i)}},error:function(e){n(),swalError("Cannot download the file!")}})},error:function(e){n(),swalError(e.responseText)}})):(n(),swalError(t.message))},error:function(e){n(),swalError("Cannot create access token!")}})};e("#captcha-response").length?(grecaptcha.reset(),grecaptcha.execute().then(a)):a()})),"undefined"!=typeof oldDBVersion&&"undefined"!=typeof newDBVersion&&oldDBVersion!==newDBVersion)var d=setInterval((function(){e.ajax({url:"ajax/?action=updateChecker",success:function(t){var a=0;"fail"!==t.status?(a=parseInt(t.result.number/t.result.total*100),0===t.result.number&&updateNow(),0===e("body #updateModal").length&&(e("body").append('<div class="modal" id="updateModal" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="updateModalLabel">Update Progress</h5></div><div class="modal-body"><p>Progressed Number: <span id="updateNumber">0</span> of <span id="updateTotal">0</span></p></p><div class="progress" style="height:20px"><div id="updateProgress" class="progress-bar" role="progressbar" style="width:0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="'+t.result.total+'">0%</div></div></div></div></div></div>'),e("body #updateModal").modal("show")),a+="%",e("body #updateModal #updateNumber").text(t.result.number),e("body #updateModal #updateTotal").text(t.result.total),e("body #updateModal #updateProgress").attr("aria-valuenow",t.result.number).css("width",a).text(a),t.result.number>0&&t.result.number>=t.result.total&&(e("body #updateModal").modal("hide"),clearInterval(d))):clearInterval(d)}})}),2e3)})),function(){"use strict";window.addEventListener("load",(function(){var e=document.getElementsByClassName("needs-validation");Array.prototype.filter.call(e,(function(e,t){e.addEventListener("submit",(function(a){!1===e.checkValidity()&&(a.preventDefault(),a.stopPropagation()),e.classList.add("was-validated"),function(e,t){var a=function(e,a,s){var n=s.html();s.html("<span id='error-"+t+"-"+e+"'>"+n+(""!==n?"<br>":"")+a+"</span>")};e.length&&$.each(e,(function(e,s){var n=$(this),o=n.next(".invalid-feedback"),i=n.val(),l=n.attr("min"),r=n.attr("max"),d=new RegExp(n.attr("pattern")),c="span#error-"+t+"-"+e+"-";0===o.length&&(o=n.closest(".input-group").find(".invalid-feedback")),n.is(":invalid")&&(o.html(""),$.each(s.dataset,(function(t,s){"Required"===(t=t.replace("error",""))&&(""===i?a(t+"-"+e,s,o):$(c+t).remove()),"Min"===t&&("number"!=typeof l||parseFloat(i)<parseFloat(l)?a(t+"-"+e,s,o):$(c+t).remove()),"Max"===t&&("number"!=typeof r||parseFloat(i)>parseFloat(r)?a(t+"-"+e,s,o):$(c+t).remove()),"Pattern"===t&&(d.test(i)?$(c+t).remove():a(t+"-"+e,s,o)),"Ajax"===t&&(""!==s?a(t+"-"+e,s,o):$(c+t).remove()),"Match"===t&&(""!==s?a(t+"-"+e,s,o):$(c+t).remove())})))}))}(e.elements,t)}),!1)}))}),!1)}();
